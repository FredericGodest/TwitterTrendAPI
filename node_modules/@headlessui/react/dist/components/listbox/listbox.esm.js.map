{"version":3,"file":"listbox.esm.js","sources":["../../../src/components/listbox/listbox.tsx"],"sourcesContent":["import React, {\n  Fragment,\n  createContext,\n  createRef,\n  useCallback,\n  useContext,\n  useMemo,\n  useReducer,\n  useRef,\n\n  // Types\n  Dispatch,\n  ElementType,\n  KeyboardEvent as ReactKeyboardEvent,\n  MouseEvent as ReactMouseEvent,\n  MutableRefObject,\n  Ref,\n} from 'react'\n\nimport { useDisposables } from '../../hooks/use-disposables'\nimport { useId } from '../../hooks/use-id'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\nimport { useComputed } from '../../hooks/use-computed'\nimport { useSyncRefs } from '../../hooks/use-sync-refs'\nimport { Props } from '../../types'\nimport { Features, forwardRefWithAs, PropsForFeatures, render } from '../../utils/render'\nimport { match } from '../../utils/match'\nimport { disposables } from '../../utils/disposables'\nimport { Keys } from '../keyboard'\nimport { Focus, calculateActiveIndex } from '../../utils/calculate-active-index'\nimport { isDisabledReactIssue7711 } from '../../utils/bugs'\nimport { isFocusableElement, FocusableMode } from '../../utils/focus-management'\nimport { useWindowEvent } from '../../hooks/use-window-event'\nimport { useOpenClosed, State, OpenClosedProvider } from '../../internal/open-closed'\n\nenum ListboxStates {\n  Open,\n  Closed,\n}\n\ntype ListboxOptionDataRef = MutableRefObject<{\n  textValue?: string\n  disabled: boolean\n  value: unknown\n}>\n\ninterface StateDefinition {\n  listboxState: ListboxStates\n  propsRef: MutableRefObject<{ value: unknown; onChange(value: unknown): void }>\n  labelRef: MutableRefObject<HTMLLabelElement | null>\n  buttonRef: MutableRefObject<HTMLButtonElement | null>\n  optionsRef: MutableRefObject<HTMLUListElement | null>\n  disabled: boolean\n  options: { id: string; dataRef: ListboxOptionDataRef }[]\n  searchQuery: string\n  activeOptionIndex: number | null\n}\n\nenum ActionTypes {\n  OpenListbox,\n  CloseListbox,\n\n  SetDisabled,\n\n  GoToOption,\n  Search,\n  ClearSearch,\n\n  RegisterOption,\n  UnregisterOption,\n}\n\ntype Actions =\n  | { type: ActionTypes.CloseListbox }\n  | { type: ActionTypes.OpenListbox }\n  | { type: ActionTypes.SetDisabled; disabled: boolean }\n  | { type: ActionTypes.GoToOption; focus: Focus.Specific; id: string }\n  | { type: ActionTypes.GoToOption; focus: Exclude<Focus, Focus.Specific> }\n  | { type: ActionTypes.Search; value: string }\n  | { type: ActionTypes.ClearSearch }\n  | { type: ActionTypes.RegisterOption; id: string; dataRef: ListboxOptionDataRef }\n  | { type: ActionTypes.UnregisterOption; id: string }\n\nlet reducers: {\n  [P in ActionTypes]: (\n    state: StateDefinition,\n    action: Extract<Actions, { type: P }>\n  ) => StateDefinition\n} = {\n  [ActionTypes.CloseListbox](state) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n    return { ...state, activeOptionIndex: null, listboxState: ListboxStates.Closed }\n  },\n  [ActionTypes.OpenListbox](state) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Open) return state\n    return { ...state, listboxState: ListboxStates.Open }\n  },\n  [ActionTypes.SetDisabled](state, action) {\n    if (state.disabled === action.disabled) return state\n    return { ...state, disabled: action.disabled }\n  },\n  [ActionTypes.GoToOption](state, action) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n\n    let activeOptionIndex = calculateActiveIndex(action, {\n      resolveItems: () => state.options,\n      resolveActiveIndex: () => state.activeOptionIndex,\n      resolveId: item => item.id,\n      resolveDisabled: item => item.dataRef.current.disabled,\n    })\n\n    if (state.searchQuery === '' && state.activeOptionIndex === activeOptionIndex) return state\n    return { ...state, searchQuery: '', activeOptionIndex }\n  },\n  [ActionTypes.Search]: (state, action) => {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n\n    let searchQuery = state.searchQuery + action.value.toLowerCase()\n    let match = state.options.findIndex(\n      option =>\n        !option.dataRef.current.disabled &&\n        option.dataRef.current.textValue?.startsWith(searchQuery)\n    )\n\n    if (match === -1 || match === state.activeOptionIndex) return { ...state, searchQuery }\n    return { ...state, searchQuery, activeOptionIndex: match }\n  },\n  [ActionTypes.ClearSearch](state) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n    if (state.searchQuery === '') return state\n    return { ...state, searchQuery: '' }\n  },\n  [ActionTypes.RegisterOption]: (state, action) => ({\n    ...state,\n    options: [...state.options, { id: action.id, dataRef: action.dataRef }],\n  }),\n  [ActionTypes.UnregisterOption]: (state, action) => {\n    let nextOptions = state.options.slice()\n    let currentActiveOption =\n      state.activeOptionIndex !== null ? nextOptions[state.activeOptionIndex] : null\n\n    let idx = nextOptions.findIndex(a => a.id === action.id)\n\n    if (idx !== -1) nextOptions.splice(idx, 1)\n\n    return {\n      ...state,\n      options: nextOptions,\n      activeOptionIndex: (() => {\n        if (idx === state.activeOptionIndex) return null\n        if (currentActiveOption === null) return null\n\n        // If we removed the option before the actual active index, then it would be out of sync. To\n        // fix this, we will find the correct (new) index position.\n        return nextOptions.indexOf(currentActiveOption)\n      })(),\n    }\n  },\n}\n\nlet ListboxContext = createContext<[StateDefinition, Dispatch<Actions>] | null>(null)\nListboxContext.displayName = 'ListboxContext'\n\nfunction useListboxContext(component: string) {\n  let context = useContext(ListboxContext)\n  if (context === null) {\n    let err = new Error(`<${component} /> is missing a parent <${Listbox.name} /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useListboxContext)\n    throw err\n  }\n  return context\n}\n\nfunction stateReducer(state: StateDefinition, action: Actions) {\n  return match(action.type, reducers, state, action)\n}\n\n// ---\n\nlet DEFAULT_LISTBOX_TAG = Fragment\ninterface ListboxRenderPropArg {\n  open: boolean\n  disabled: boolean\n}\n\nexport function Listbox<TTag extends ElementType = typeof DEFAULT_LISTBOX_TAG, TType = string>(\n  props: Props<TTag, ListboxRenderPropArg, 'value' | 'onChange'> & {\n    value: TType\n    onChange(value: TType): void\n    disabled?: boolean\n  }\n) {\n  let { value, onChange, disabled = false, ...passThroughProps } = props\n  let reducerBag = useReducer(stateReducer, {\n    listboxState: ListboxStates.Closed,\n    propsRef: { current: { value, onChange } },\n    labelRef: createRef(),\n    buttonRef: createRef(),\n    optionsRef: createRef(),\n    disabled,\n    options: [],\n    searchQuery: '',\n    activeOptionIndex: null,\n  } as StateDefinition)\n  let [{ listboxState, propsRef, optionsRef, buttonRef }, dispatch] = reducerBag\n\n  useIsoMorphicEffect(() => {\n    propsRef.current.value = value\n  }, [value, propsRef])\n  useIsoMorphicEffect(() => {\n    propsRef.current.onChange = onChange\n  }, [onChange, propsRef])\n  useIsoMorphicEffect(() => dispatch({ type: ActionTypes.SetDisabled, disabled }), [disabled])\n\n  // Handle outside click\n  useWindowEvent('mousedown', event => {\n    let target = event.target as HTMLElement\n\n    if (listboxState !== ListboxStates.Open) return\n\n    if (buttonRef.current?.contains(target)) return\n    if (optionsRef.current?.contains(target)) return\n\n    dispatch({ type: ActionTypes.CloseListbox })\n\n    if (!isFocusableElement(target, FocusableMode.Loose)) {\n      event.preventDefault()\n      buttonRef.current?.focus()\n    }\n  })\n\n  let slot = useMemo<ListboxRenderPropArg>(\n    () => ({ open: listboxState === ListboxStates.Open, disabled }),\n    [listboxState, disabled]\n  )\n\n  return (\n    <ListboxContext.Provider value={reducerBag}>\n      <OpenClosedProvider\n        value={match(listboxState, {\n          [ListboxStates.Open]: State.Open,\n          [ListboxStates.Closed]: State.Closed,\n        })}\n      >\n        {render({\n          props: passThroughProps,\n          slot,\n          defaultTag: DEFAULT_LISTBOX_TAG,\n          name: 'Listbox',\n        })}\n      </OpenClosedProvider>\n    </ListboxContext.Provider>\n  )\n}\n\n// ---\n\nlet DEFAULT_BUTTON_TAG = 'button' as const\ninterface ButtonRenderPropArg {\n  open: boolean\n  disabled: boolean\n}\ntype ButtonPropsWeControl =\n  | 'id'\n  | 'type'\n  | 'aria-haspopup'\n  | 'aria-controls'\n  | 'aria-expanded'\n  | 'aria-labelledby'\n  | 'disabled'\n  | 'onKeyDown'\n  | 'onClick'\n\nlet Button = forwardRefWithAs(function Button<TTag extends ElementType = typeof DEFAULT_BUTTON_TAG>(\n  props: Props<TTag, ButtonRenderPropArg, ButtonPropsWeControl>,\n  ref: Ref<HTMLButtonElement>\n) {\n  let [state, dispatch] = useListboxContext([Listbox.name, Button.name].join('.'))\n  let buttonRef = useSyncRefs(state.buttonRef, ref)\n\n  let id = `headlessui-listbox-button-${useId()}`\n  let d = useDisposables()\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLButtonElement>) => {\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n\n        case Keys.Space:\n        case Keys.Enter:\n        case Keys.ArrowDown:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.OpenListbox })\n          d.nextFrame(() => {\n            if (!state.propsRef.current.value)\n              dispatch({ type: ActionTypes.GoToOption, focus: Focus.First })\n          })\n          break\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.OpenListbox })\n          d.nextFrame(() => {\n            if (!state.propsRef.current.value)\n              dispatch({ type: ActionTypes.GoToOption, focus: Focus.Last })\n          })\n          break\n      }\n    },\n    [dispatch, state, d]\n  )\n\n  let handleKeyUp = useCallback((event: ReactKeyboardEvent<HTMLButtonElement>) => {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault()\n        break\n    }\n  }, [])\n\n  let handleClick = useCallback(\n    (event: ReactMouseEvent) => {\n      if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault()\n      if (state.listboxState === ListboxStates.Open) {\n        dispatch({ type: ActionTypes.CloseListbox })\n        d.nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      } else {\n        event.preventDefault()\n        dispatch({ type: ActionTypes.OpenListbox })\n      }\n    },\n    [dispatch, d, state]\n  )\n\n  let labelledby = useComputed(() => {\n    if (!state.labelRef.current) return undefined\n    return [state.labelRef.current.id, id].join(' ')\n  }, [state.labelRef.current, id])\n\n  let slot = useMemo<ButtonRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open, disabled: state.disabled }),\n    [state]\n  )\n  let passthroughProps = props\n  let propsWeControl = {\n    ref: buttonRef,\n    id,\n    type: 'button',\n    'aria-haspopup': true,\n    'aria-controls': state.optionsRef.current?.id,\n    'aria-expanded': state.disabled ? undefined : state.listboxState === ListboxStates.Open,\n    'aria-labelledby': labelledby,\n    disabled: state.disabled,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    onClick: handleClick,\n  }\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_BUTTON_TAG,\n    name: 'Listbox.Button',\n  })\n})\n\n// ---\n\nlet DEFAULT_LABEL_TAG = 'label' as const\ninterface LabelRenderPropArg {\n  open: boolean\n  disabled: boolean\n}\ntype LabelPropsWeControl = 'id' | 'ref' | 'onClick'\n\nfunction Label<TTag extends ElementType = typeof DEFAULT_LABEL_TAG>(\n  props: Props<TTag, LabelRenderPropArg, LabelPropsWeControl>\n) {\n  let [state] = useListboxContext([Listbox.name, Label.name].join('.'))\n  let id = `headlessui-listbox-label-${useId()}`\n\n  let handleClick = useCallback(() => state.buttonRef.current?.focus({ preventScroll: true }), [\n    state.buttonRef,\n  ])\n\n  let slot = useMemo<LabelRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open, disabled: state.disabled }),\n    [state]\n  )\n  let propsWeControl = { ref: state.labelRef, id, onClick: handleClick }\n  return render({\n    props: { ...props, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_LABEL_TAG,\n    name: 'Listbox.Label',\n  })\n}\n\n// ---\n\nlet DEFAULT_OPTIONS_TAG = 'ul' as const\ninterface OptionsRenderPropArg {\n  open: boolean\n}\ntype OptionsPropsWeControl =\n  | 'aria-activedescendant'\n  | 'aria-labelledby'\n  | 'id'\n  | 'onKeyDown'\n  | 'role'\n  | 'tabIndex'\n\nlet OptionsRenderFeatures = Features.RenderStrategy | Features.Static\n\nlet Options = forwardRefWithAs(function Options<\n  TTag extends ElementType = typeof DEFAULT_OPTIONS_TAG\n>(\n  props: Props<TTag, OptionsRenderPropArg, OptionsPropsWeControl> &\n    PropsForFeatures<typeof OptionsRenderFeatures>,\n  ref: Ref<HTMLUListElement>\n) {\n  let [state, dispatch] = useListboxContext([Listbox.name, Options.name].join('.'))\n  let optionsRef = useSyncRefs(state.optionsRef, ref)\n\n  let id = `headlessui-listbox-options-${useId()}`\n  let d = useDisposables()\n  let searchDisposables = useDisposables()\n\n  let usesOpenClosedState = useOpenClosed()\n  let visible = (() => {\n    if (usesOpenClosedState !== null) {\n      return usesOpenClosedState === State.Open\n    }\n\n    return state.listboxState === ListboxStates.Open\n  })()\n\n  useIsoMorphicEffect(() => {\n    let container = state.optionsRef.current\n    if (!container) return\n    if (state.listboxState !== ListboxStates.Open) return\n    if (container === document.activeElement) return\n\n    container.focus({ preventScroll: true })\n  }, [state.listboxState, state.optionsRef])\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLUListElement>) => {\n      searchDisposables.dispose()\n\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n\n        // @ts-expect-error Fallthrough is expected here\n        case Keys.Space:\n          if (state.searchQuery !== '') {\n            event.preventDefault()\n            event.stopPropagation()\n            return dispatch({ type: ActionTypes.Search, value: event.key })\n          }\n        // When in type ahead mode, fallthrough\n        case Keys.Enter:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.CloseListbox })\n          if (state.activeOptionIndex !== null) {\n            let { dataRef } = state.options[state.activeOptionIndex]\n            state.propsRef.current.onChange(dataRef.current.value)\n          }\n          disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n          break\n\n        case Keys.ArrowDown:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Next })\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Previous })\n\n        case Keys.Home:\n        case Keys.PageUp:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.First })\n\n        case Keys.End:\n        case Keys.PageDown:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Last })\n\n        case Keys.Escape:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.CloseListbox })\n          return d.nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n\n        case Keys.Tab:\n          event.preventDefault()\n          event.stopPropagation()\n          break\n\n        default:\n          if (event.key.length === 1) {\n            dispatch({ type: ActionTypes.Search, value: event.key })\n            searchDisposables.setTimeout(() => dispatch({ type: ActionTypes.ClearSearch }), 350)\n          }\n          break\n      }\n    },\n    [d, dispatch, searchDisposables, state]\n  )\n\n  let labelledby = useComputed(() => state.labelRef.current?.id ?? state.buttonRef.current?.id, [\n    state.labelRef.current,\n    state.buttonRef.current,\n  ])\n\n  let slot = useMemo<OptionsRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open }),\n    [state]\n  )\n  let propsWeControl = {\n    'aria-activedescendant':\n      state.activeOptionIndex === null ? undefined : state.options[state.activeOptionIndex]?.id,\n    'aria-labelledby': labelledby,\n    id,\n    onKeyDown: handleKeyDown,\n    role: 'listbox',\n    tabIndex: 0,\n    ref: optionsRef,\n  }\n  let passthroughProps = props\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_OPTIONS_TAG,\n    features: OptionsRenderFeatures,\n    visible,\n    name: 'Listbox.Options',\n  })\n})\n\n// ---\n\nlet DEFAULT_OPTION_TAG = 'li' as const\ninterface OptionRenderPropArg {\n  active: boolean\n  selected: boolean\n  disabled: boolean\n}\ntype ListboxOptionPropsWeControl =\n  | 'id'\n  | 'role'\n  | 'tabIndex'\n  | 'aria-disabled'\n  | 'aria-selected'\n  | 'onPointerLeave'\n  | 'onMouseLeave'\n  | 'onPointerMove'\n  | 'onMouseMove'\n  | 'onFocus'\n\nfunction Option<\n  TTag extends ElementType = typeof DEFAULT_OPTION_TAG,\n  // TODO: One day we will be able to infer this type from the generic in Listbox itself.\n  // But today is not that day..\n  TType = Parameters<typeof Listbox>[0]['value']\n>(\n  props: Props<TTag, OptionRenderPropArg, ListboxOptionPropsWeControl | 'value'> & {\n    disabled?: boolean\n    value: TType\n  }\n) {\n  let { disabled = false, value, ...passthroughProps } = props\n  let [state, dispatch] = useListboxContext([Listbox.name, Option.name].join('.'))\n  let id = `headlessui-listbox-option-${useId()}`\n  let active =\n    state.activeOptionIndex !== null ? state.options[state.activeOptionIndex].id === id : false\n  let selected = state.propsRef.current.value === value\n\n  let bag = useRef<ListboxOptionDataRef['current']>({ disabled, value })\n\n  useIsoMorphicEffect(() => {\n    bag.current.disabled = disabled\n  }, [bag, disabled])\n  useIsoMorphicEffect(() => {\n    bag.current.value = value\n  }, [bag, value])\n  useIsoMorphicEffect(() => {\n    bag.current.textValue = document.getElementById(id)?.textContent?.toLowerCase()\n  }, [bag, id])\n\n  let select = useCallback(() => state.propsRef.current.onChange(value), [state.propsRef, value])\n\n  useIsoMorphicEffect(() => {\n    dispatch({ type: ActionTypes.RegisterOption, id, dataRef: bag })\n    return () => dispatch({ type: ActionTypes.UnregisterOption, id })\n  }, [bag, id])\n\n  useIsoMorphicEffect(() => {\n    if (state.listboxState !== ListboxStates.Open) return\n    if (!selected) return\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n    document.getElementById(id)?.focus?.()\n  }, [state.listboxState])\n\n  useIsoMorphicEffect(() => {\n    if (state.listboxState !== ListboxStates.Open) return\n    if (!active) return\n    let d = disposables()\n    d.nextFrame(() => document.getElementById(id)?.scrollIntoView?.({ block: 'nearest' }))\n    return d.dispose\n  }, [id, active, state.listboxState])\n\n  let handleClick = useCallback(\n    (event: { preventDefault: Function }) => {\n      if (disabled) return event.preventDefault()\n      select()\n      dispatch({ type: ActionTypes.CloseListbox })\n      disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n    },\n    [dispatch, state.buttonRef, disabled, select]\n  )\n\n  let handleFocus = useCallback(() => {\n    if (disabled) return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Nothing })\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n  }, [disabled, id, dispatch])\n\n  let handleMove = useCallback(() => {\n    if (disabled) return\n    if (active) return\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n  }, [disabled, active, id, dispatch])\n\n  let handleLeave = useCallback(() => {\n    if (disabled) return\n    if (!active) return\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Nothing })\n  }, [disabled, active, dispatch])\n\n  let slot = useMemo<OptionRenderPropArg>(() => ({ active, selected, disabled }), [\n    active,\n    selected,\n    disabled,\n  ])\n  let propsWeControl = {\n    id,\n    role: 'option',\n    tabIndex: disabled === true ? undefined : -1,\n    'aria-disabled': disabled === true ? true : undefined,\n    'aria-selected': selected === true ? true : undefined,\n    disabled: undefined, // Never forward the `disabled` prop\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handleMove,\n    onMouseMove: handleMove,\n    onPointerLeave: handleLeave,\n    onMouseLeave: handleLeave,\n  }\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_OPTION_TAG,\n    name: 'Listbox.Option',\n  })\n}\n\n// ---\n\nListbox.Button = Button\nListbox.Label = Label\nListbox.Options = Options\nListbox.Option = Option\n"],"names":["ListboxStates","ActionTypes","reducers","CloseListbox","state","disabled","listboxState","Closed","activeOptionIndex","OpenListbox","Open","SetDisabled","action","GoToOption","calculateActiveIndex","resolveItems","options","resolveActiveIndex","resolveId","item","id","resolveDisabled","dataRef","current","searchQuery","Search","value","toLowerCase","match","findIndex","option","textValue","startsWith","ClearSearch","RegisterOption","UnregisterOption","nextOptions","slice","currentActiveOption","idx","a","splice","indexOf","ListboxContext","createContext","displayName","useListboxContext","component","context","useContext","err","Error","Listbox","name","captureStackTrace","stateReducer","type","DEFAULT_LISTBOX_TAG","Fragment","props","onChange","passThroughProps","reducerBag","useReducer","propsRef","labelRef","createRef","buttonRef","optionsRef","dispatch","useIsoMorphicEffect","useWindowEvent","event","target","contains","isFocusableElement","FocusableMode","Loose","preventDefault","focus","slot","useMemo","open","React","Provider","OpenClosedProvider","State","render","defaultTag","DEFAULT_BUTTON_TAG","Button","forwardRefWithAs","ref","join","useSyncRefs","useId","d","useDisposables","handleKeyDown","useCallback","key","Keys","Space","Enter","ArrowDown","nextFrame","Focus","First","ArrowUp","Last","handleKeyUp","handleClick","isDisabledReactIssue7711","currentTarget","preventScroll","labelledby","useComputed","undefined","passthroughProps","propsWeControl","onKeyDown","onKeyUp","onClick","DEFAULT_LABEL_TAG","Label","DEFAULT_OPTIONS_TAG","OptionsRenderFeatures","Features","RenderStrategy","Static","Options","searchDisposables","usesOpenClosedState","useOpenClosed","visible","container","document","activeElement","dispose","stopPropagation","disposables","Next","Previous","Home","PageUp","End","PageDown","Escape","Tab","length","setTimeout","role","tabIndex","features","DEFAULT_OPTION_TAG","Option","active","selected","bag","useRef","getElementById","textContent","select","Specific","scrollIntoView","block","handleFocus","Nothing","handleMove","handleLeave","onFocus","onPointerMove","onMouseMove","onPointerLeave","onMouseLeave"],"mappings":";;;;;;;;;;;;;;;;;;AAmCA,IAAKA,aAAL;;AAAA,WAAKA;AACHA,EAAAA,wCAAA,SAAA;AACAA,EAAAA,0CAAA,WAAA;AACD,CAHD,EAAKA,aAAa,KAAbA,aAAa,KAAA,CAAlB;;AAuBA,IAAKC,WAAL;;AAAA,WAAKA;AACHA,EAAAA,2CAAA,gBAAA;AACAA,EAAAA,4CAAA,iBAAA;AAEAA,EAAAA,2CAAA,gBAAA;AAEAA,EAAAA,0CAAA,eAAA;AACAA,EAAAA,sCAAA,WAAA;AACAA,EAAAA,2CAAA,gBAAA;AAEAA,EAAAA,8CAAA,mBAAA;AACAA,EAAAA,gDAAA,qBAAA;AACD,CAZD,EAAKA,WAAW,KAAXA,WAAW,KAAA,CAAhB;;AAyBA,IAAIC,QAAQ,8BAMTD,WAAW,CAACE,YANH,cAMiBC,KANjB;AAOR,MAAIA,KAAK,CAACC,QAAV,EAAoB,OAAOD,KAAP;AACpB,MAAIA,KAAK,CAACE,YAAN,KAAuBN,aAAa,CAACO,MAAzC,EAAiD,OAAOH,KAAP;AACjD,sBAAYA,KAAZ;AAAmBI,IAAAA,iBAAiB,EAAE,IAAtC;AAA4CF,IAAAA,YAAY,EAAEN,aAAa,CAACO;AAAxE;AACD,CAVS,YAWTN,WAAW,CAACQ,WAXH,cAWgBL,KAXhB;AAYR,MAAIA,KAAK,CAACC,QAAV,EAAoB,OAAOD,KAAP;AACpB,MAAIA,KAAK,CAACE,YAAN,KAAuBN,aAAa,CAACU,IAAzC,EAA+C,OAAON,KAAP;AAC/C,sBAAYA,KAAZ;AAAmBE,IAAAA,YAAY,EAAEN,aAAa,CAACU;AAA/C;AACD,CAfS,YAgBTT,WAAW,CAACU,WAhBH,cAgBgBP,KAhBhB,EAgBuBQ,MAhBvB;AAiBR,MAAIR,KAAK,CAACC,QAAN,KAAmBO,MAAM,CAACP,QAA9B,EAAwC,OAAOD,KAAP;AACxC,sBAAYA,KAAZ;AAAmBC,IAAAA,QAAQ,EAAEO,MAAM,CAACP;AAApC;AACD,CAnBS,YAoBTJ,WAAW,CAACY,UApBH,cAoBeT,KApBf,EAoBsBQ,MApBtB;AAqBR,MAAIR,KAAK,CAACC,QAAV,EAAoB,OAAOD,KAAP;AACpB,MAAIA,KAAK,CAACE,YAAN,KAAuBN,aAAa,CAACO,MAAzC,EAAiD,OAAOH,KAAP;AAEjD,MAAII,iBAAiB,GAAGM,oBAAoB,CAACF,MAAD,EAAS;AACnDG,IAAAA,YAAY,EAAE;AAAA,aAAMX,KAAK,CAACY,OAAZ;AAAA,KADqC;AAEnDC,IAAAA,kBAAkB,EAAE;AAAA,aAAMb,KAAK,CAACI,iBAAZ;AAAA,KAF+B;AAGnDU,IAAAA,SAAS,EAAE,mBAAAC,IAAI;AAAA,aAAIA,IAAI,CAACC,EAAT;AAAA,KAHoC;AAInDC,IAAAA,eAAe,EAAE,yBAAAF,IAAI;AAAA,aAAIA,IAAI,CAACG,OAAL,CAAaC,OAAb,CAAqBlB,QAAzB;AAAA;AAJ8B,GAAT,CAA5C;AAOA,MAAID,KAAK,CAACoB,WAAN,KAAsB,EAAtB,IAA4BpB,KAAK,CAACI,iBAAN,KAA4BA,iBAA5D,EAA+E,OAAOJ,KAAP;AAC/E,sBAAYA,KAAZ;AAAmBoB,IAAAA,WAAW,EAAE,EAAhC;AAAoChB,IAAAA,iBAAiB,EAAjBA;AAApC;AACD,CAjCS,YAkCTP,WAAW,CAACwB,MAlCH,IAkCY,UAACrB,KAAD,EAAQQ,MAAR;AACpB,MAAIR,KAAK,CAACC,QAAV,EAAoB,OAAOD,KAAP;AACpB,MAAIA,KAAK,CAACE,YAAN,KAAuBN,aAAa,CAACO,MAAzC,EAAiD,OAAOH,KAAP;AAEjD,MAAIoB,WAAW,GAAGpB,KAAK,CAACoB,WAAN,GAAoBZ,MAAM,CAACc,KAAP,CAAaC,WAAb,EAAtC;AACA,MAAIC,KAAK,GAAGxB,KAAK,CAACY,OAAN,CAAca,SAAd,CACV,UAAAC,MAAM;AAAA;;AAAA,WACJ,CAACA,MAAM,CAACR,OAAP,CAAeC,OAAf,CAAuBlB,QAAxB,8BACAyB,MAAM,CAACR,OAAP,CAAeC,OAAf,CAAuBQ,SADvB,qBACA,sBAAkCC,UAAlC,CAA6CR,WAA7C,CADA,CADI;AAAA,GADI,CAAZ;AAMA,MAAII,KAAK,KAAK,CAAC,CAAX,IAAgBA,KAAK,KAAKxB,KAAK,CAACI,iBAApC,EAAuD,oBAAYJ,KAAZ;AAAmBoB,IAAAA,WAAW,EAAXA;AAAnB;AACvD,sBAAYpB,KAAZ;AAAmBoB,IAAAA,WAAW,EAAXA,WAAnB;AAAgChB,IAAAA,iBAAiB,EAAEoB;AAAnD;AACD,CA/CS,YAgDT3B,WAAW,CAACgC,WAhDH,cAgDgB7B,KAhDhB;AAiDR,MAAIA,KAAK,CAACC,QAAV,EAAoB,OAAOD,KAAP;AACpB,MAAIA,KAAK,CAACE,YAAN,KAAuBN,aAAa,CAACO,MAAzC,EAAiD,OAAOH,KAAP;AACjD,MAAIA,KAAK,CAACoB,WAAN,KAAsB,EAA1B,EAA8B,OAAOpB,KAAP;AAC9B,sBAAYA,KAAZ;AAAmBoB,IAAAA,WAAW,EAAE;AAAhC;AACD,CArDS,YAsDTvB,WAAW,CAACiC,cAtDH,IAsDoB,UAAC9B,KAAD,EAAQQ,MAAR;AAAA,sBACzBR,KADyB;AAE5BY,IAAAA,OAAO,YAAMZ,KAAK,CAACY,OAAZ,GAAqB;AAAEI,MAAAA,EAAE,EAAER,MAAM,CAACQ,EAAb;AAAiBE,MAAAA,OAAO,EAAEV,MAAM,CAACU;AAAjC,KAArB;AAFqB;AAAA,CAtDpB,YA0DTrB,WAAW,CAACkC,gBA1DH,IA0DsB,UAAC/B,KAAD,EAAQQ,MAAR;AAC9B,MAAIwB,WAAW,GAAGhC,KAAK,CAACY,OAAN,CAAcqB,KAAd,EAAlB;AACA,MAAIC,mBAAmB,GACrBlC,KAAK,CAACI,iBAAN,KAA4B,IAA5B,GAAmC4B,WAAW,CAAChC,KAAK,CAACI,iBAAP,CAA9C,GAA0E,IAD5E;AAGA,MAAI+B,GAAG,GAAGH,WAAW,CAACP,SAAZ,CAAsB,UAAAW,CAAC;AAAA,WAAIA,CAAC,CAACpB,EAAF,KAASR,MAAM,CAACQ,EAApB;AAAA,GAAvB,CAAV;AAEA,MAAImB,GAAG,KAAK,CAAC,CAAb,EAAgBH,WAAW,CAACK,MAAZ,CAAmBF,GAAnB,EAAwB,CAAxB;AAEhB,sBACKnC,KADL;AAEEY,IAAAA,OAAO,EAAEoB,WAFX;AAGE5B,IAAAA,iBAAiB,EAAG;AAClB,UAAI+B,GAAG,KAAKnC,KAAK,CAACI,iBAAlB,EAAqC,OAAO,IAAP;AACrC,UAAI8B,mBAAmB,KAAK,IAA5B,EAAkC,OAAO,IAAP;AAGlC;;AACA,aAAOF,WAAW,CAACM,OAAZ,CAAoBJ,mBAApB,CAAP;AACD,KAPkB;AAHrB;AAYD,CA/ES,YAAZ;AAkFA,IAAIK,cAAc,gBAAGC,aAAa,CAA8C,IAA9C,CAAlC;AACAD,cAAc,CAACE,WAAf,GAA6B,gBAA7B;;AAEA,SAASC,iBAAT,CAA2BC,SAA3B;AACE,MAAIC,OAAO,GAAGC,UAAU,CAACN,cAAD,CAAxB;;AACA,MAAIK,OAAO,KAAK,IAAhB,EAAsB;AACpB,QAAIE,GAAG,GAAG,IAAIC,KAAJ,OAAcJ,SAAd,iCAAmDK,OAAO,CAACC,IAA3D,oBAAV;AACA,QAAIF,KAAK,CAACG,iBAAV,EAA6BH,KAAK,CAACG,iBAAN,CAAwBJ,GAAxB,EAA6BJ,iBAA7B;AAC7B,UAAMI,GAAN;AACD;;AACD,SAAOF,OAAP;AACD;;AAED,SAASO,YAAT,CAAsBnD,KAAtB,EAA8CQ,MAA9C;AACE,SAAOgB,KAAK,CAAChB,MAAM,CAAC4C,IAAR,EAActD,QAAd,EAAwBE,KAAxB,EAA+BQ,MAA/B,CAAZ;AACD;;;AAID,IAAI6C,mBAAmB,GAAGC,QAA1B;SAMgBN,QACdO;;;MAMMjC,QAA2DiC,MAA3DjC;MAAOkC,WAAoDD,MAApDC;wBAAoDD,MAA1CtD;MAAAA,wCAAW;MAAUwD,iDAAqBF;;AACjE,MAAIG,UAAU,GAAGC,UAAU,CAACR,YAAD,EAAe;AACxCjD,IAAAA,YAAY,EAAEN,aAAa,CAACO,MADY;AAExCyD,IAAAA,QAAQ,EAAE;AAAEzC,MAAAA,OAAO,EAAE;AAAEG,QAAAA,KAAK,EAALA,KAAF;AAASkC,QAAAA,QAAQ,EAARA;AAAT;AAAX,KAF8B;AAGxCK,IAAAA,QAAQ,EAAEC,SAAS,EAHqB;AAIxCC,IAAAA,SAAS,EAAED,SAAS,EAJoB;AAKxCE,IAAAA,UAAU,EAAEF,SAAS,EALmB;AAMxC7D,IAAAA,QAAQ,EAARA,QANwC;AAOxCW,IAAAA,OAAO,EAAE,EAP+B;AAQxCQ,IAAAA,WAAW,EAAE,EAR2B;AASxChB,IAAAA,iBAAiB,EAAE;AATqB,GAAf,CAA3B;qBAWoEsD;MAA7DxD,4BAAAA;MAAc0D,wBAAAA;MAAUI,0BAAAA;MAAYD,yBAAAA;MAAaE,WAAYP;AAEpEQ,EAAAA,mBAAmB,CAAC;AAClBN,IAAAA,QAAQ,CAACzC,OAAT,CAAiBG,KAAjB,GAAyBA,KAAzB;AACD,GAFkB,EAEhB,CAACA,KAAD,EAAQsC,QAAR,CAFgB,CAAnB;AAGAM,EAAAA,mBAAmB,CAAC;AAClBN,IAAAA,QAAQ,CAACzC,OAAT,CAAiBqC,QAAjB,GAA4BA,QAA5B;AACD,GAFkB,EAEhB,CAACA,QAAD,EAAWI,QAAX,CAFgB,CAAnB;AAGAM,EAAAA,mBAAmB,CAAC;AAAA,WAAMD,QAAQ,CAAC;AAAEb,MAAAA,IAAI,EAAEvD,WAAW,CAACU,WAApB;AAAiCN,MAAAA,QAAQ,EAARA;AAAjC,KAAD,CAAd;AAAA,GAAD,EAA8D,CAACA,QAAD,CAA9D,CAAnB;;AAGAkE,EAAAA,cAAc,CAAC,WAAD,EAAc,UAAAC,KAAK;;;AAC/B,QAAIC,MAAM,GAAGD,KAAK,CAACC,MAAnB;AAEA,QAAInE,YAAY,KAAKN,aAAa,CAACU,IAAnC,EAAyC;AAEzC,8BAAIyD,SAAS,CAAC5C,OAAd,qBAAI,mBAAmBmD,QAAnB,CAA4BD,MAA5B,CAAJ,EAAyC;AACzC,+BAAIL,UAAU,CAAC7C,OAAf,qBAAI,oBAAoBmD,QAApB,CAA6BD,MAA7B,CAAJ,EAA0C;AAE1CJ,IAAAA,QAAQ,CAAC;AAAEb,MAAAA,IAAI,EAAEvD,WAAW,CAACE;AAApB,KAAD,CAAR;;AAEA,QAAI,CAACwE,kBAAkB,CAACF,MAAD,EAASG,aAAa,CAACC,KAAvB,CAAvB,EAAsD;AAAA;;AACpDL,MAAAA,KAAK,CAACM,cAAN;AACA,6BAAAX,SAAS,CAAC5C,OAAV,yCAAmBwD,KAAnB;AACD;AACF,GAda,CAAd;AAgBA,MAAIC,IAAI,GAAGC,OAAO,CAChB;AAAA,WAAO;AAAEC,MAAAA,IAAI,EAAE5E,YAAY,KAAKN,aAAa,CAACU,IAAvC;AAA6CL,MAAAA,QAAQ,EAARA;AAA7C,KAAP;AAAA,GADgB,EAEhB,CAACC,YAAD,EAAeD,QAAf,CAFgB,CAAlB;AAKA,SACE8E,mBAAA,CAACxC,cAAc,CAACyC,QAAhB;AAAyB1D,IAAAA,KAAK,EAAEoC;GAAhC,EACEqB,mBAAA,CAACE,kBAAD;AACE3D,IAAAA,KAAK,EAAEE,KAAK,CAACtB,YAAD,uBACTN,aAAa,CAACU,IADL,IACY4E,KAAK,CAAC5E,IADlB,SAETV,aAAa,CAACO,MAFL,IAEc+E,KAAK,CAAC/E,MAFpB;GADd,EAMGgF,MAAM,CAAC;AACN5B,IAAAA,KAAK,EAAEE,gBADD;AAENmB,IAAAA,IAAI,EAAJA,IAFM;AAGNQ,IAAAA,UAAU,EAAE/B,mBAHN;AAINJ,IAAAA,IAAI,EAAE;AAJA,GAAD,CANT,CADF,CADF;AAiBD;;AAID,IAAIoC,kBAAkB,GAAG,QAAzB;AAgBA,IAAIC,MAAM,gBAAGC,gBAAgB,CAAC,SAASD,MAAT,CAC5B/B,KAD4B,EAE5BiC,GAF4B;;;2BAIJ9C,iBAAiB,CAAC,CAACM,OAAO,CAACC,IAAT,EAAeqC,MAAM,CAACrC,IAAtB,EAA4BwC,IAA5B,CAAiC,GAAjC,CAAD;MAApCzF;MAAOiE;;AACZ,MAAIF,SAAS,GAAG2B,WAAW,CAAC1F,KAAK,CAAC+D,SAAP,EAAkByB,GAAlB,CAA3B;AAEA,MAAIxE,EAAE,kCAAgC2E,KAAK,EAA3C;AACA,MAAIC,CAAC,GAAGC,cAAc,EAAtB;AAEA,MAAIC,aAAa,GAAGC,WAAW,CAC7B,UAAC3B,KAAD;AACE,YAAQA,KAAK,CAAC4B,GAAd;AACE;AAEA,WAAKC,IAAI,CAACC,KAAV;AACA,WAAKD,IAAI,CAACE,KAAV;AACA,WAAKF,IAAI,CAACG,SAAV;AACEhC,QAAAA,KAAK,CAACM,cAAN;AACAT,QAAAA,QAAQ,CAAC;AAAEb,UAAAA,IAAI,EAAEvD,WAAW,CAACQ;AAApB,SAAD,CAAR;AACAuF,QAAAA,CAAC,CAACS,SAAF,CAAY;AACV,cAAI,CAACrG,KAAK,CAAC4D,QAAN,CAAezC,OAAf,CAAuBG,KAA5B,EACE2C,QAAQ,CAAC;AAAEb,YAAAA,IAAI,EAAEvD,WAAW,CAACY,UAApB;AAAgCkE,YAAAA,KAAK,EAAE2B,KAAK,CAACC;AAA7C,WAAD,CAAR;AACH,SAHD;AAIA;;AAEF,WAAKN,IAAI,CAACO,OAAV;AACEpC,QAAAA,KAAK,CAACM,cAAN;AACAT,QAAAA,QAAQ,CAAC;AAAEb,UAAAA,IAAI,EAAEvD,WAAW,CAACQ;AAApB,SAAD,CAAR;AACAuF,QAAAA,CAAC,CAACS,SAAF,CAAY;AACV,cAAI,CAACrG,KAAK,CAAC4D,QAAN,CAAezC,OAAf,CAAuBG,KAA5B,EACE2C,QAAQ,CAAC;AAAEb,YAAAA,IAAI,EAAEvD,WAAW,CAACY,UAApB;AAAgCkE,YAAAA,KAAK,EAAE2B,KAAK,CAACG;AAA7C,WAAD,CAAR;AACH,SAHD;AAIA;AArBJ;AAuBD,GAzB4B,EA0B7B,CAACxC,QAAD,EAAWjE,KAAX,EAAkB4F,CAAlB,CA1B6B,CAA/B;AA6BA,MAAIc,WAAW,GAAGX,WAAW,CAAC,UAAC3B,KAAD;AAC5B,YAAQA,KAAK,CAAC4B,GAAd;AACE,WAAKC,IAAI,CAACC,KAAV;AACE;AACA;AACA;AACA9B,QAAAA,KAAK,CAACM,cAAN;AACA;AANJ;AAQD,GAT4B,EAS1B,EAT0B,CAA7B;AAWA,MAAIiC,WAAW,GAAGZ,WAAW,CAC3B,UAAC3B,KAAD;AACE,QAAIwC,wBAAwB,CAACxC,KAAK,CAACyC,aAAP,CAA5B,EAAmD,OAAOzC,KAAK,CAACM,cAAN,EAAP;;AACnD,QAAI1E,KAAK,CAACE,YAAN,KAAuBN,aAAa,CAACU,IAAzC,EAA+C;AAC7C2D,MAAAA,QAAQ,CAAC;AAAEb,QAAAA,IAAI,EAAEvD,WAAW,CAACE;AAApB,OAAD,CAAR;AACA6F,MAAAA,CAAC,CAACS,SAAF,CAAY;AAAA;;AAAA,wCAAMrG,KAAK,CAAC+D,SAAN,CAAgB5C,OAAtB,qBAAM,sBAAyBwD,KAAzB,CAA+B;AAAEmC,UAAAA,aAAa,EAAE;AAAjB,SAA/B,CAAN;AAAA,OAAZ;AACD,KAHD,MAGO;AACL1C,MAAAA,KAAK,CAACM,cAAN;AACAT,MAAAA,QAAQ,CAAC;AAAEb,QAAAA,IAAI,EAAEvD,WAAW,CAACQ;AAApB,OAAD,CAAR;AACD;AACF,GAV0B,EAW3B,CAAC4D,QAAD,EAAW2B,CAAX,EAAc5F,KAAd,CAX2B,CAA7B;AAcA,MAAI+G,UAAU,GAAGC,WAAW,CAAC;AAC3B,QAAI,CAAChH,KAAK,CAAC6D,QAAN,CAAe1C,OAApB,EAA6B,OAAO8F,SAAP;AAC7B,WAAO,CAACjH,KAAK,CAAC6D,QAAN,CAAe1C,OAAf,CAAuBH,EAAxB,EAA4BA,EAA5B,EAAgCyE,IAAhC,CAAqC,GAArC,CAAP;AACD,GAH2B,EAGzB,CAACzF,KAAK,CAAC6D,QAAN,CAAe1C,OAAhB,EAAyBH,EAAzB,CAHyB,CAA5B;AAKA,MAAI4D,IAAI,GAAGC,OAAO,CAChB;AAAA,WAAO;AAAEC,MAAAA,IAAI,EAAE9E,KAAK,CAACE,YAAN,KAAuBN,aAAa,CAACU,IAA7C;AAAmDL,MAAAA,QAAQ,EAAED,KAAK,CAACC;AAAnE,KAAP;AAAA,GADgB,EAEhB,CAACD,KAAD,CAFgB,CAAlB;AAIA,MAAIkH,gBAAgB,GAAG3D,KAAvB;AACA,MAAI4D,cAAc,GAAG;AACnB3B,IAAAA,GAAG,EAAEzB,SADc;AAEnB/C,IAAAA,EAAE,EAAFA,EAFmB;AAGnBoC,IAAAA,IAAI,EAAE,QAHa;AAInB,qBAAiB,IAJE;AAKnB,8CAAiBpD,KAAK,CAACgE,UAAN,CAAiB7C,OAAlC,qBAAiB,sBAA0BH,EALxB;AAMnB,qBAAiBhB,KAAK,CAACC,QAAN,GAAiBgH,SAAjB,GAA6BjH,KAAK,CAACE,YAAN,KAAuBN,aAAa,CAACU,IANhE;AAOnB,uBAAmByG,UAPA;AAQnB9G,IAAAA,QAAQ,EAAED,KAAK,CAACC,QARG;AASnBmH,IAAAA,SAAS,EAAEtB,aATQ;AAUnBuB,IAAAA,OAAO,EAAEX,WAVU;AAWnBY,IAAAA,OAAO,EAAEX;AAXU,GAArB;AAcA,SAAOxB,MAAM,CAAC;AACZ5B,IAAAA,KAAK,eAAO2D,gBAAP,EAA4BC,cAA5B,CADO;AAEZvC,IAAAA,IAAI,EAAJA,IAFY;AAGZQ,IAAAA,UAAU,EAAEC,kBAHA;AAIZpC,IAAAA,IAAI,EAAE;AAJM,GAAD,CAAb;AAMD,CA9F4B,CAA7B;;AAkGA,IAAIsE,iBAAiB,GAAG,OAAxB;;AAOA,SAASC,KAAT,CACEjE,KADF;4BAGgBb,iBAAiB,CAAC,CAACM,OAAO,CAACC,IAAT,EAAeuE,KAAK,CAACvE,IAArB,EAA2BwC,IAA3B,CAAgC,GAAhC,CAAD;MAA1BzF;;AACL,MAAIgB,EAAE,iCAA+B2E,KAAK,EAA1C;AAEA,MAAIgB,WAAW,GAAGZ,WAAW,CAAC;AAAA;;AAAA,qCAAM/F,KAAK,CAAC+D,SAAN,CAAgB5C,OAAtB,qBAAM,uBAAyBwD,KAAzB,CAA+B;AAAEmC,MAAAA,aAAa,EAAE;AAAjB,KAA/B,CAAN;AAAA,GAAD,EAAgE,CAC3F9G,KAAK,CAAC+D,SADqF,CAAhE,CAA7B;AAIA,MAAIa,IAAI,GAAGC,OAAO,CAChB;AAAA,WAAO;AAAEC,MAAAA,IAAI,EAAE9E,KAAK,CAACE,YAAN,KAAuBN,aAAa,CAACU,IAA7C;AAAmDL,MAAAA,QAAQ,EAAED,KAAK,CAACC;AAAnE,KAAP;AAAA,GADgB,EAEhB,CAACD,KAAD,CAFgB,CAAlB;AAIA,MAAImH,cAAc,GAAG;AAAE3B,IAAAA,GAAG,EAAExF,KAAK,CAAC6D,QAAb;AAAuB7C,IAAAA,EAAE,EAAFA,EAAvB;AAA2BsG,IAAAA,OAAO,EAAEX;AAApC,GAArB;AACA,SAAOxB,MAAM,CAAC;AACZ5B,IAAAA,KAAK,eAAOA,KAAP,EAAiB4D,cAAjB,CADO;AAEZvC,IAAAA,IAAI,EAAJA,IAFY;AAGZQ,IAAAA,UAAU,EAAEmC,iBAHA;AAIZtE,IAAAA,IAAI,EAAE;AAJM,GAAD,CAAb;AAMD;;;AAID,IAAIwE,mBAAmB,GAAG,IAA1B;AAYA,IAAIC,qBAAqB,GAAGC,QAAQ,CAACC,cAAT,GAA0BD,QAAQ,CAACE,MAA/D;AAEA,IAAIC,OAAO,gBAAGvC,gBAAgB,CAAC,SAASuC,OAAT,CAG7BvE,KAH6B,EAK7BiC,GAL6B;;;4BAOL9C,iBAAiB,CAAC,CAACM,OAAO,CAACC,IAAT,EAAe6E,OAAO,CAAC7E,IAAvB,EAA6BwC,IAA7B,CAAkC,GAAlC,CAAD;MAApCzF;MAAOiE;;AACZ,MAAID,UAAU,GAAG0B,WAAW,CAAC1F,KAAK,CAACgE,UAAP,EAAmBwB,GAAnB,CAA5B;AAEA,MAAIxE,EAAE,mCAAiC2E,KAAK,EAA5C;AACA,MAAIC,CAAC,GAAGC,cAAc,EAAtB;AACA,MAAIkC,iBAAiB,GAAGlC,cAAc,EAAtC;AAEA,MAAImC,mBAAmB,GAAGC,aAAa,EAAvC;;AACA,MAAIC,OAAO,GAAI;AACb,QAAIF,mBAAmB,KAAK,IAA5B,EAAkC;AAChC,aAAOA,mBAAmB,KAAK9C,KAAK,CAAC5E,IAArC;AACD;;AAED,WAAON,KAAK,CAACE,YAAN,KAAuBN,aAAa,CAACU,IAA5C;AACD,GANa,EAAd;;AAQA4D,EAAAA,mBAAmB,CAAC;AAClB,QAAIiE,SAAS,GAAGnI,KAAK,CAACgE,UAAN,CAAiB7C,OAAjC;AACA,QAAI,CAACgH,SAAL,EAAgB;AAChB,QAAInI,KAAK,CAACE,YAAN,KAAuBN,aAAa,CAACU,IAAzC,EAA+C;AAC/C,QAAI6H,SAAS,KAAKC,QAAQ,CAACC,aAA3B,EAA0C;AAE1CF,IAAAA,SAAS,CAACxD,KAAV,CAAgB;AAAEmC,MAAAA,aAAa,EAAE;AAAjB,KAAhB;AACD,GAPkB,EAOhB,CAAC9G,KAAK,CAACE,YAAP,EAAqBF,KAAK,CAACgE,UAA3B,CAPgB,CAAnB;AASA,MAAI8B,aAAa,GAAGC,WAAW,CAC7B,UAAC3B,KAAD;AACE2D,IAAAA,iBAAiB,CAACO,OAAlB;;AAEA,YAAQlE,KAAK,CAAC4B,GAAd;AACE;AAEA;AACA,WAAKC,IAAI,CAACC,KAAV;AACE,YAAIlG,KAAK,CAACoB,WAAN,KAAsB,EAA1B,EAA8B;AAC5BgD,UAAAA,KAAK,CAACM,cAAN;AACAN,UAAAA,KAAK,CAACmE,eAAN;AACA,iBAAOtE,QAAQ,CAAC;AAAEb,YAAAA,IAAI,EAAEvD,WAAW,CAACwB,MAApB;AAA4BC,YAAAA,KAAK,EAAE8C,KAAK,CAAC4B;AAAzC,WAAD,CAAf;AACD;;AACH;;AACA,WAAKC,IAAI,CAACE,KAAV;AACE/B,QAAAA,KAAK,CAACM,cAAN;AACAN,QAAAA,KAAK,CAACmE,eAAN;AACAtE,QAAAA,QAAQ,CAAC;AAAEb,UAAAA,IAAI,EAAEvD,WAAW,CAACE;AAApB,SAAD,CAAR;;AACA,YAAIC,KAAK,CAACI,iBAAN,KAA4B,IAAhC,EAAsC;AAAA,cAC9Bc,OAD8B,GAClBlB,KAAK,CAACY,OAAN,CAAcZ,KAAK,CAACI,iBAApB,CADkB,CAC9Bc,OAD8B;AAEpClB,UAAAA,KAAK,CAAC4D,QAAN,CAAezC,OAAf,CAAuBqC,QAAvB,CAAgCtC,OAAO,CAACC,OAAR,CAAgBG,KAAhD;AACD;;AACDkH,QAAAA,WAAW,GAAGnC,SAAd,CAAwB;AAAA;;AAAA,2CAAMrG,KAAK,CAAC+D,SAAN,CAAgB5C,OAAtB,qBAAM,uBAAyBwD,KAAzB,CAA+B;AAAEmC,YAAAA,aAAa,EAAE;AAAjB,WAA/B,CAAN;AAAA,SAAxB;AACA;;AAEF,WAAKb,IAAI,CAACG,SAAV;AACEhC,QAAAA,KAAK,CAACM,cAAN;AACAN,QAAAA,KAAK,CAACmE,eAAN;AACA,eAAOtE,QAAQ,CAAC;AAAEb,UAAAA,IAAI,EAAEvD,WAAW,CAACY,UAApB;AAAgCkE,UAAAA,KAAK,EAAE2B,KAAK,CAACmC;AAA7C,SAAD,CAAf;;AAEF,WAAKxC,IAAI,CAACO,OAAV;AACEpC,QAAAA,KAAK,CAACM,cAAN;AACAN,QAAAA,KAAK,CAACmE,eAAN;AACA,eAAOtE,QAAQ,CAAC;AAAEb,UAAAA,IAAI,EAAEvD,WAAW,CAACY,UAApB;AAAgCkE,UAAAA,KAAK,EAAE2B,KAAK,CAACoC;AAA7C,SAAD,CAAf;;AAEF,WAAKzC,IAAI,CAAC0C,IAAV;AACA,WAAK1C,IAAI,CAAC2C,MAAV;AACExE,QAAAA,KAAK,CAACM,cAAN;AACAN,QAAAA,KAAK,CAACmE,eAAN;AACA,eAAOtE,QAAQ,CAAC;AAAEb,UAAAA,IAAI,EAAEvD,WAAW,CAACY,UAApB;AAAgCkE,UAAAA,KAAK,EAAE2B,KAAK,CAACC;AAA7C,SAAD,CAAf;;AAEF,WAAKN,IAAI,CAAC4C,GAAV;AACA,WAAK5C,IAAI,CAAC6C,QAAV;AACE1E,QAAAA,KAAK,CAACM,cAAN;AACAN,QAAAA,KAAK,CAACmE,eAAN;AACA,eAAOtE,QAAQ,CAAC;AAAEb,UAAAA,IAAI,EAAEvD,WAAW,CAACY,UAApB;AAAgCkE,UAAAA,KAAK,EAAE2B,KAAK,CAACG;AAA7C,SAAD,CAAf;;AAEF,WAAKR,IAAI,CAAC8C,MAAV;AACE3E,QAAAA,KAAK,CAACM,cAAN;AACAN,QAAAA,KAAK,CAACmE,eAAN;AACAtE,QAAAA,QAAQ,CAAC;AAAEb,UAAAA,IAAI,EAAEvD,WAAW,CAACE;AAApB,SAAD,CAAR;AACA,eAAO6F,CAAC,CAACS,SAAF,CAAY;AAAA;;AAAA,2CAAMrG,KAAK,CAAC+D,SAAN,CAAgB5C,OAAtB,qBAAM,uBAAyBwD,KAAzB,CAA+B;AAAEmC,YAAAA,aAAa,EAAE;AAAjB,WAA/B,CAAN;AAAA,SAAZ,CAAP;;AAEF,WAAKb,IAAI,CAAC+C,GAAV;AACE5E,QAAAA,KAAK,CAACM,cAAN;AACAN,QAAAA,KAAK,CAACmE,eAAN;AACA;;AAEF;AACE,YAAInE,KAAK,CAAC4B,GAAN,CAAUiD,MAAV,KAAqB,CAAzB,EAA4B;AAC1BhF,UAAAA,QAAQ,CAAC;AAAEb,YAAAA,IAAI,EAAEvD,WAAW,CAACwB,MAApB;AAA4BC,YAAAA,KAAK,EAAE8C,KAAK,CAAC4B;AAAzC,WAAD,CAAR;AACA+B,UAAAA,iBAAiB,CAACmB,UAAlB,CAA6B;AAAA,mBAAMjF,QAAQ,CAAC;AAAEb,cAAAA,IAAI,EAAEvD,WAAW,CAACgC;AAApB,aAAD,CAAd;AAAA,WAA7B,EAAgF,GAAhF;AACD;;AACD;AA5DJ;AA8DD,GAlE4B,EAmE7B,CAAC+D,CAAD,EAAI3B,QAAJ,EAAc8D,iBAAd,EAAiC/H,KAAjC,CAnE6B,CAA/B;AAsEA,MAAI+G,UAAU,GAAGC,WAAW,CAAC;AAAA;;AAAA,8DAAMhH,KAAK,CAAC6D,QAAN,CAAe1C,OAArB,qBAAM,uBAAwBH,EAA9B,8DAAoChB,KAAK,CAAC+D,SAAN,CAAgB5C,OAApD,qBAAoC,uBAAyBH,EAA7D;AAAA,GAAD,EAAkE,CAC5FhB,KAAK,CAAC6D,QAAN,CAAe1C,OAD6E,EAE5FnB,KAAK,CAAC+D,SAAN,CAAgB5C,OAF4E,CAAlE,CAA5B;AAKA,MAAIyD,IAAI,GAAGC,OAAO,CAChB;AAAA,WAAO;AAAEC,MAAAA,IAAI,EAAE9E,KAAK,CAACE,YAAN,KAAuBN,aAAa,CAACU;AAA7C,KAAP;AAAA,GADgB,EAEhB,CAACN,KAAD,CAFgB,CAAlB;AAIA,MAAImH,cAAc,GAAG;AACnB,6BACEnH,KAAK,CAACI,iBAAN,KAA4B,IAA5B,GAAmC6G,SAAnC,4BAA+CjH,KAAK,CAACY,OAAN,CAAcZ,KAAK,CAACI,iBAApB,CAA/C,qBAA+C,sBAAwCY,EAFtE;AAGnB,uBAAmB+F,UAHA;AAInB/F,IAAAA,EAAE,EAAFA,EAJmB;AAKnBoG,IAAAA,SAAS,EAAEtB,aALQ;AAMnBqD,IAAAA,IAAI,EAAE,SANa;AAOnBC,IAAAA,QAAQ,EAAE,CAPS;AAQnB5D,IAAAA,GAAG,EAAExB;AARc,GAArB;AAUA,MAAIkD,gBAAgB,GAAG3D,KAAvB;AAEA,SAAO4B,MAAM,CAAC;AACZ5B,IAAAA,KAAK,eAAO2D,gBAAP,EAA4BC,cAA5B,CADO;AAEZvC,IAAAA,IAAI,EAAJA,IAFY;AAGZQ,IAAAA,UAAU,EAAEqC,mBAHA;AAIZ4B,IAAAA,QAAQ,EAAE3B,qBAJE;AAKZQ,IAAAA,OAAO,EAAPA,OALY;AAMZjF,IAAAA,IAAI,EAAE;AANM,GAAD,CAAb;AAQD,CAnI6B,CAA9B;;AAuIA,IAAIqG,kBAAkB,GAAG,IAAzB;;AAkBA,SAASC,MAAT,CAMEhG,KANF;yBAWyDA,MAAjDtD;MAAAA,yCAAW;MAAOqB,QAA+BiC,MAA/BjC;MAAU4F,iDAAqB3D;;4BAC/Bb,iBAAiB,CAAC,CAACM,OAAO,CAACC,IAAT,EAAesG,MAAM,CAACtG,IAAtB,EAA4BwC,IAA5B,CAAiC,GAAjC,CAAD;MAApCzF;MAAOiE;;AACZ,MAAIjD,EAAE,kCAAgC2E,KAAK,EAA3C;AACA,MAAI6D,MAAM,GACRxJ,KAAK,CAACI,iBAAN,KAA4B,IAA5B,GAAmCJ,KAAK,CAACY,OAAN,CAAcZ,KAAK,CAACI,iBAApB,EAAuCY,EAAvC,KAA8CA,EAAjF,GAAsF,KADxF;AAEA,MAAIyI,QAAQ,GAAGzJ,KAAK,CAAC4D,QAAN,CAAezC,OAAf,CAAuBG,KAAvB,KAAiCA,KAAhD;AAEA,MAAIoI,GAAG,GAAGC,MAAM,CAAkC;AAAE1J,IAAAA,QAAQ,EAARA,QAAF;AAAYqB,IAAAA,KAAK,EAALA;AAAZ,GAAlC,CAAhB;AAEA4C,EAAAA,mBAAmB,CAAC;AAClBwF,IAAAA,GAAG,CAACvI,OAAJ,CAAYlB,QAAZ,GAAuBA,QAAvB;AACD,GAFkB,EAEhB,CAACyJ,GAAD,EAAMzJ,QAAN,CAFgB,CAAnB;AAGAiE,EAAAA,mBAAmB,CAAC;AAClBwF,IAAAA,GAAG,CAACvI,OAAJ,CAAYG,KAAZ,GAAoBA,KAApB;AACD,GAFkB,EAEhB,CAACoI,GAAD,EAAMpI,KAAN,CAFgB,CAAnB;AAGA4C,EAAAA,mBAAmB,CAAC;;;AAClBwF,IAAAA,GAAG,CAACvI,OAAJ,CAAYQ,SAAZ,4BAAwByG,QAAQ,CAACwB,cAAT,CAAwB5I,EAAxB,CAAxB,+CAAwB,sBAA6B6I,WAArD,qBAAwB,uBAA0CtI,WAA1C,EAAxB;AACD,GAFkB,EAEhB,CAACmI,GAAD,EAAM1I,EAAN,CAFgB,CAAnB;AAIA,MAAI8I,MAAM,GAAG/D,WAAW,CAAC;AAAA,WAAM/F,KAAK,CAAC4D,QAAN,CAAezC,OAAf,CAAuBqC,QAAvB,CAAgClC,KAAhC,CAAN;AAAA,GAAD,EAA+C,CAACtB,KAAK,CAAC4D,QAAP,EAAiBtC,KAAjB,CAA/C,CAAxB;AAEA4C,EAAAA,mBAAmB,CAAC;AAClBD,IAAAA,QAAQ,CAAC;AAAEb,MAAAA,IAAI,EAAEvD,WAAW,CAACiC,cAApB;AAAoCd,MAAAA,EAAE,EAAFA,EAApC;AAAwCE,MAAAA,OAAO,EAAEwI;AAAjD,KAAD,CAAR;AACA,WAAO;AAAA,aAAMzF,QAAQ,CAAC;AAAEb,QAAAA,IAAI,EAAEvD,WAAW,CAACkC,gBAApB;AAAsCf,QAAAA,EAAE,EAAFA;AAAtC,OAAD,CAAd;AAAA,KAAP;AACD,GAHkB,EAGhB,CAAC0I,GAAD,EAAM1I,EAAN,CAHgB,CAAnB;AAKAkD,EAAAA,mBAAmB,CAAC;;;AAClB,QAAIlE,KAAK,CAACE,YAAN,KAAuBN,aAAa,CAACU,IAAzC,EAA+C;AAC/C,QAAI,CAACmJ,QAAL,EAAe;AACfxF,IAAAA,QAAQ,CAAC;AAAEb,MAAAA,IAAI,EAAEvD,WAAW,CAACY,UAApB;AAAgCkE,MAAAA,KAAK,EAAE2B,KAAK,CAACyD,QAA7C;AAAuD/I,MAAAA,EAAE,EAAFA;AAAvD,KAAD,CAAR;AACA,8BAAAoH,QAAQ,CAACwB,cAAT,CAAwB5I,EAAxB,6CAA6B2D,KAA7B,2CAA6BA,KAA7B;AACD,GALkB,EAKhB,CAAC3E,KAAK,CAACE,YAAP,CALgB,CAAnB;AAOAgE,EAAAA,mBAAmB,CAAC;AAClB,QAAIlE,KAAK,CAACE,YAAN,KAAuBN,aAAa,CAACU,IAAzC,EAA+C;AAC/C,QAAI,CAACkJ,MAAL,EAAa;AACb,QAAI5D,CAAC,GAAG4C,WAAW,EAAnB;AACA5C,IAAAA,CAAC,CAACS,SAAF,CAAY;AAAA;;AAAA,uCAAM+B,QAAQ,CAACwB,cAAT,CAAwB5I,EAAxB,CAAN,qBAAM,uBAA6BgJ,cAAnC,oBAAM,uBAA6BA,cAA7B,CAA8C;AAAEC,QAAAA,KAAK,EAAE;AAAT,OAA9C,CAAN;AAAA,KAAZ;AACA,WAAOrE,CAAC,CAAC0C,OAAT;AACD,GANkB,EAMhB,CAACtH,EAAD,EAAKwI,MAAL,EAAaxJ,KAAK,CAACE,YAAnB,CANgB,CAAnB;AAQA,MAAIyG,WAAW,GAAGZ,WAAW,CAC3B,UAAC3B,KAAD;AACE,QAAInE,QAAJ,EAAc,OAAOmE,KAAK,CAACM,cAAN,EAAP;AACdoF,IAAAA,MAAM;AACN7F,IAAAA,QAAQ,CAAC;AAAEb,MAAAA,IAAI,EAAEvD,WAAW,CAACE;AAApB,KAAD,CAAR;AACAyI,IAAAA,WAAW,GAAGnC,SAAd,CAAwB;AAAA;;AAAA,uCAAMrG,KAAK,CAAC+D,SAAN,CAAgB5C,OAAtB,qBAAM,uBAAyBwD,KAAzB,CAA+B;AAAEmC,QAAAA,aAAa,EAAE;AAAjB,OAA/B,CAAN;AAAA,KAAxB;AACD,GAN0B,EAO3B,CAAC7C,QAAD,EAAWjE,KAAK,CAAC+D,SAAjB,EAA4B9D,QAA5B,EAAsC6J,MAAtC,CAP2B,CAA7B;AAUA,MAAII,WAAW,GAAGnE,WAAW,CAAC;AAC5B,QAAI9F,QAAJ,EAAc,OAAOgE,QAAQ,CAAC;AAAEb,MAAAA,IAAI,EAAEvD,WAAW,CAACY,UAApB;AAAgCkE,MAAAA,KAAK,EAAE2B,KAAK,CAAC6D;AAA7C,KAAD,CAAf;AACdlG,IAAAA,QAAQ,CAAC;AAAEb,MAAAA,IAAI,EAAEvD,WAAW,CAACY,UAApB;AAAgCkE,MAAAA,KAAK,EAAE2B,KAAK,CAACyD,QAA7C;AAAuD/I,MAAAA,EAAE,EAAFA;AAAvD,KAAD,CAAR;AACD,GAH4B,EAG1B,CAACf,QAAD,EAAWe,EAAX,EAAeiD,QAAf,CAH0B,CAA7B;AAKA,MAAImG,UAAU,GAAGrE,WAAW,CAAC;AAC3B,QAAI9F,QAAJ,EAAc;AACd,QAAIuJ,MAAJ,EAAY;AACZvF,IAAAA,QAAQ,CAAC;AAAEb,MAAAA,IAAI,EAAEvD,WAAW,CAACY,UAApB;AAAgCkE,MAAAA,KAAK,EAAE2B,KAAK,CAACyD,QAA7C;AAAuD/I,MAAAA,EAAE,EAAFA;AAAvD,KAAD,CAAR;AACD,GAJ2B,EAIzB,CAACf,QAAD,EAAWuJ,MAAX,EAAmBxI,EAAnB,EAAuBiD,QAAvB,CAJyB,CAA5B;AAMA,MAAIoG,WAAW,GAAGtE,WAAW,CAAC;AAC5B,QAAI9F,QAAJ,EAAc;AACd,QAAI,CAACuJ,MAAL,EAAa;AACbvF,IAAAA,QAAQ,CAAC;AAAEb,MAAAA,IAAI,EAAEvD,WAAW,CAACY,UAApB;AAAgCkE,MAAAA,KAAK,EAAE2B,KAAK,CAAC6D;AAA7C,KAAD,CAAR;AACD,GAJ4B,EAI1B,CAAClK,QAAD,EAAWuJ,MAAX,EAAmBvF,QAAnB,CAJ0B,CAA7B;AAMA,MAAIW,IAAI,GAAGC,OAAO,CAAsB;AAAA,WAAO;AAAE2E,MAAAA,MAAM,EAANA,MAAF;AAAUC,MAAAA,QAAQ,EAARA,QAAV;AAAoBxJ,MAAAA,QAAQ,EAARA;AAApB,KAAP;AAAA,GAAtB,EAA8D,CAC9EuJ,MAD8E,EAE9EC,QAF8E,EAG9ExJ,QAH8E,CAA9D,CAAlB;AAKA,MAAIkH,cAAc,GAAG;AACnBnG,IAAAA,EAAE,EAAFA,EADmB;AAEnBmI,IAAAA,IAAI,EAAE,QAFa;AAGnBC,IAAAA,QAAQ,EAAEnJ,QAAQ,KAAK,IAAb,GAAoBgH,SAApB,GAAgC,CAAC,CAHxB;AAInB,qBAAiBhH,QAAQ,KAAK,IAAb,GAAoB,IAApB,GAA2BgH,SAJzB;AAKnB,qBAAiBwC,QAAQ,KAAK,IAAb,GAAoB,IAApB,GAA2BxC,SALzB;AAMnBhH,IAAAA,QAAQ,EAAEgH,SANS;AAOnBK,IAAAA,OAAO,EAAEX,WAPU;AAQnB2D,IAAAA,OAAO,EAAEJ,WARU;AASnBK,IAAAA,aAAa,EAAEH,UATI;AAUnBI,IAAAA,WAAW,EAAEJ,UAVM;AAWnBK,IAAAA,cAAc,EAAEJ,WAXG;AAYnBK,IAAAA,YAAY,EAAEL;AAZK,GAArB;AAeA,SAAOlF,MAAM,CAAC;AACZ5B,IAAAA,KAAK,eAAO2D,gBAAP,EAA4BC,cAA5B,CADO;AAEZvC,IAAAA,IAAI,EAAJA,IAFY;AAGZQ,IAAAA,UAAU,EAAEkE,kBAHA;AAIZrG,IAAAA,IAAI,EAAE;AAJM,GAAD,CAAb;AAMD;;;AAIDD,OAAO,CAACsC,MAAR,GAAiBA,MAAjB;AACAtC,OAAO,CAACwE,KAAR,GAAgBA,KAAhB;AACAxE,OAAO,CAAC8E,OAAR,GAAkBA,OAAlB;AACA9E,OAAO,CAACuG,MAAR,GAAiBA,MAAjB;;;;"}