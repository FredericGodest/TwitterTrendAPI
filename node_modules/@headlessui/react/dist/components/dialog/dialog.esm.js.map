{"version":3,"file":"dialog.esm.js","sources":["../../../src/components/dialog/dialog.tsx"],"sourcesContent":["// WAI-ARIA: https://www.w3.org/TR/wai-aria-practices-1.2/#dialog_modal\nimport React, {\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n\n  // Types\n  ContextType,\n  ElementType,\n  MouseEvent as ReactMouseEvent,\n  KeyboardEvent as ReactKeyboardEvent,\n  MutableRefObject,\n  Ref,\n  useState,\n} from 'react'\n\nimport { Props } from '../../types'\nimport { match } from '../../utils/match'\nimport { forwardRefWithAs, render, Features, PropsForFeatures } from '../../utils/render'\nimport { useSyncRefs } from '../../hooks/use-sync-refs'\nimport { Keys } from '../keyboard'\nimport { isDisabledReactIssue7711 } from '../../utils/bugs'\nimport { useId } from '../../hooks/use-id'\nimport { useFocusTrap, Features as FocusTrapFeatures } from '../../hooks/use-focus-trap'\nimport { useInertOthers } from '../../hooks/use-inert-others'\nimport { Portal } from '../../components/portal/portal'\nimport { ForcePortalRoot } from '../../internal/portal-force-root'\nimport { Description, useDescriptions } from '../description/description'\nimport { useWindowEvent } from '../../hooks/use-window-event'\nimport { useOpenClosed, State } from '../../internal/open-closed'\nimport { useServerHandoffComplete } from '../../hooks/use-server-handoff-complete'\nimport { StackProvider, StackMessage } from '../../internal/stack-context'\n\nenum DialogStates {\n  Open,\n  Closed,\n}\n\ninterface StateDefinition {\n  titleId: string | null\n}\n\nenum ActionTypes {\n  SetTitleId,\n}\n\ntype Actions = { type: ActionTypes.SetTitleId; id: string | null }\n\nlet reducers: {\n  [P in ActionTypes]: (\n    state: StateDefinition,\n    action: Extract<Actions, { type: P }>\n  ) => StateDefinition\n} = {\n  [ActionTypes.SetTitleId](state, action) {\n    if (state.titleId === action.id) return state\n    return { ...state, titleId: action.id }\n  },\n}\n\nlet DialogContext = createContext<\n  | [\n      {\n        dialogState: DialogStates\n        close(): void\n        setTitleId(id: string | null): void\n      },\n      StateDefinition\n    ]\n  | null\n>(null)\nDialogContext.displayName = 'DialogContext'\n\nfunction useDialogContext(component: string) {\n  let context = useContext(DialogContext)\n  if (context === null) {\n    let err = new Error(`<${component} /> is missing a parent <${Dialog.displayName} /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useDialogContext)\n    throw err\n  }\n  return context\n}\n\nfunction stateReducer(state: StateDefinition, action: Actions) {\n  return match(action.type, reducers, state, action)\n}\n\n// ---\n\nlet DEFAULT_DIALOG_TAG = 'div' as const\ninterface DialogRenderPropArg {\n  open: boolean\n}\ntype DialogPropsWeControl =\n  | 'id'\n  | 'role'\n  | 'aria-modal'\n  | 'aria-describedby'\n  | 'aria-labelledby'\n  | 'onClick'\n\nlet DialogRenderFeatures = Features.RenderStrategy | Features.Static\n\nlet DialogRoot = forwardRefWithAs(function Dialog<\n  TTag extends ElementType = typeof DEFAULT_DIALOG_TAG\n>(\n  props: Props<TTag, DialogRenderPropArg, DialogPropsWeControl> &\n    PropsForFeatures<typeof DialogRenderFeatures> & {\n      open?: boolean\n      onClose(value: boolean): void\n      initialFocus?: MutableRefObject<HTMLElement | null>\n    },\n  ref: Ref<HTMLDivElement>\n) {\n  let { open, onClose, initialFocus, ...rest } = props\n  let [nestedDialogCount, setNestedDialogCount] = useState(0)\n\n  let usesOpenClosedState = useOpenClosed()\n  if (open === undefined && usesOpenClosedState !== null) {\n    // Update the `open` prop based on the open closed state\n    open = match(usesOpenClosedState, {\n      [State.Open]: true,\n      [State.Closed]: false,\n    })\n  }\n\n  let containers = useRef<Set<MutableRefObject<HTMLElement | null>>>(new Set())\n  let internalDialogRef = useRef<HTMLDivElement | null>(null)\n  let dialogRef = useSyncRefs(internalDialogRef, ref)\n\n  // Validations\n  let hasOpen = props.hasOwnProperty('open') || usesOpenClosedState !== null\n  let hasOnClose = props.hasOwnProperty('onClose')\n  if (!hasOpen && !hasOnClose) {\n    throw new Error(\n      `You have to provide an \\`open\\` and an \\`onClose\\` prop to the \\`Dialog\\` component.`\n    )\n  }\n\n  if (!hasOpen) {\n    throw new Error(\n      `You provided an \\`onClose\\` prop to the \\`Dialog\\`, but forgot an \\`open\\` prop.`\n    )\n  }\n\n  if (!hasOnClose) {\n    throw new Error(\n      `You provided an \\`open\\` prop to the \\`Dialog\\`, but forgot an \\`onClose\\` prop.`\n    )\n  }\n\n  if (typeof open !== 'boolean') {\n    throw new Error(\n      `You provided an \\`open\\` prop to the \\`Dialog\\`, but the value is not a boolean. Received: ${open}`\n    )\n  }\n\n  if (typeof onClose !== 'function') {\n    throw new Error(\n      `You provided an \\`onClose\\` prop to the \\`Dialog\\`, but the value is not a function. Received: ${onClose}`\n    )\n  }\n  let dialogState = open ? DialogStates.Open : DialogStates.Closed\n  let visible = (() => {\n    if (usesOpenClosedState !== null) {\n      return usesOpenClosedState === State.Open\n    }\n\n    return dialogState === DialogStates.Open\n  })()\n\n  let [state, dispatch] = useReducer(stateReducer, {\n    titleId: null,\n    descriptionId: null,\n  } as StateDefinition)\n\n  let close = useCallback(() => onClose(false), [onClose])\n\n  let setTitleId = useCallback(\n    (id: string | null) => dispatch({ type: ActionTypes.SetTitleId, id }),\n    [dispatch]\n  )\n\n  let ready = useServerHandoffComplete()\n  let enabled = ready && dialogState === DialogStates.Open\n  let hasNestedDialogs = nestedDialogCount > 1 // 1 is the current dialog\n  let hasParentDialog = useContext(DialogContext) !== null\n\n  // If there are multiple dialogs, then you can be the root, the leaf or one\n  // in between. We only care abou whether you are the top most one or not.\n  let position = !hasNestedDialogs ? 'leaf' : 'parent'\n\n  useFocusTrap(\n    internalDialogRef,\n    enabled\n      ? match(position, {\n          parent: FocusTrapFeatures.RestoreFocus,\n          leaf: FocusTrapFeatures.All,\n        })\n      : FocusTrapFeatures.None,\n    { initialFocus, containers }\n  )\n  useInertOthers(internalDialogRef, hasNestedDialogs ? enabled : false)\n\n  // Handle outside click\n  useWindowEvent('mousedown', event => {\n    let target = event.target as HTMLElement\n\n    if (dialogState !== DialogStates.Open) return\n    if (hasNestedDialogs) return\n    if (internalDialogRef.current?.contains(target)) return\n\n    close()\n  })\n\n  // Scroll lock\n  useEffect(() => {\n    if (dialogState !== DialogStates.Open) return\n    if (hasParentDialog) return\n\n    let overflow = document.documentElement.style.overflow\n    let paddingRight = document.documentElement.style.paddingRight\n\n    let scrollbarWidth = window.innerWidth - document.documentElement.clientWidth\n\n    document.documentElement.style.overflow = 'hidden'\n    document.documentElement.style.paddingRight = `${scrollbarWidth}px`\n\n    return () => {\n      document.documentElement.style.overflow = overflow\n      document.documentElement.style.paddingRight = paddingRight\n    }\n  }, [dialogState, hasParentDialog])\n\n  // Trigger close when the FocusTrap gets hidden\n  useEffect(() => {\n    if (dialogState !== DialogStates.Open) return\n    if (!internalDialogRef.current) return\n\n    let observer = new IntersectionObserver(entries => {\n      for (let entry of entries) {\n        if (\n          entry.boundingClientRect.x === 0 &&\n          entry.boundingClientRect.y === 0 &&\n          entry.boundingClientRect.width === 0 &&\n          entry.boundingClientRect.height === 0\n        ) {\n          close()\n        }\n      }\n    })\n\n    observer.observe(internalDialogRef.current)\n\n    return () => observer.disconnect()\n  }, [dialogState, internalDialogRef, close])\n\n  let [describedby, DescriptionProvider] = useDescriptions()\n\n  let id = `headlessui-dialog-${useId()}`\n\n  let contextBag = useMemo<ContextType<typeof DialogContext>>(\n    () => [{ dialogState, close, setTitleId }, state],\n    [dialogState, state, close, setTitleId]\n  )\n\n  let slot = useMemo<DialogRenderPropArg>(() => ({ open: dialogState === DialogStates.Open }), [\n    dialogState,\n  ])\n\n  let propsWeControl = {\n    ref: dialogRef,\n    id,\n    role: 'dialog',\n    'aria-modal': dialogState === DialogStates.Open ? true : undefined,\n    'aria-labelledby': state.titleId,\n    'aria-describedby': describedby,\n    onClick(event: ReactMouseEvent) {\n      event.stopPropagation()\n    },\n\n    // Handle `Escape` to close\n    onKeyDown(event: ReactKeyboardEvent) {\n      if (event.key !== Keys.Escape) return\n      if (dialogState !== DialogStates.Open) return\n      if (hasNestedDialogs) return\n      event.preventDefault()\n      event.stopPropagation()\n      close()\n    },\n  }\n  let passthroughProps = rest\n\n  return (\n    <StackProvider\n      type=\"Dialog\"\n      element={internalDialogRef}\n      onUpdate={useCallback((message, type, element) => {\n        if (type !== 'Dialog') return\n\n        match(message, {\n          [StackMessage.Add]() {\n            containers.current.add(element)\n            setNestedDialogCount(count => count + 1)\n          },\n          [StackMessage.Remove]() {\n            containers.current.add(element)\n            setNestedDialogCount(count => count - 1)\n          },\n        })\n      }, [])}\n    >\n      <ForcePortalRoot force={true}>\n        <Portal>\n          <DialogContext.Provider value={contextBag}>\n            <Portal.Group target={internalDialogRef}>\n              <ForcePortalRoot force={false}>\n                <DescriptionProvider slot={slot} name=\"Dialog.Description\">\n                  {render({\n                    props: { ...passthroughProps, ...propsWeControl },\n                    slot,\n                    defaultTag: DEFAULT_DIALOG_TAG,\n                    features: DialogRenderFeatures,\n                    visible,\n                    name: 'Dialog',\n                  })}\n                </DescriptionProvider>\n              </ForcePortalRoot>\n            </Portal.Group>\n          </DialogContext.Provider>\n        </Portal>\n      </ForcePortalRoot>\n    </StackProvider>\n  )\n})\n\n// ---\n\nlet DEFAULT_OVERLAY_TAG = 'div' as const\ninterface OverlayRenderPropArg {\n  open: boolean\n}\ntype OverlayPropsWeControl = 'id' | 'aria-hidden' | 'onClick'\n\nlet Overlay = forwardRefWithAs(function Overlay<\n  TTag extends ElementType = typeof DEFAULT_OVERLAY_TAG\n>(props: Props<TTag, OverlayRenderPropArg, OverlayPropsWeControl>, ref: Ref<HTMLDivElement>) {\n  let [{ dialogState, close }] = useDialogContext([Dialog.displayName, Overlay.name].join('.'))\n  let overlayRef = useSyncRefs(ref)\n\n  let id = `headlessui-dialog-overlay-${useId()}`\n\n  let handleClick = useCallback(\n    (event: ReactMouseEvent) => {\n      if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault()\n      event.preventDefault()\n      event.stopPropagation()\n      close()\n    },\n    [close]\n  )\n\n  let slot = useMemo<OverlayRenderPropArg>(() => ({ open: dialogState === DialogStates.Open }), [\n    dialogState,\n  ])\n  let propsWeControl = {\n    ref: overlayRef,\n    id,\n    'aria-hidden': true,\n    onClick: handleClick,\n  }\n  let passthroughProps = props\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_OVERLAY_TAG,\n    name: 'Dialog.Overlay',\n  })\n})\n\n// ---\n\nlet DEFAULT_TITLE_TAG = 'h2' as const\ninterface TitleRenderPropArg {\n  open: boolean\n}\ntype TitlePropsWeControl = 'id'\n\nfunction Title<TTag extends ElementType = typeof DEFAULT_TITLE_TAG>(\n  props: Props<TTag, TitleRenderPropArg, TitlePropsWeControl>\n) {\n  let [{ dialogState, setTitleId }] = useDialogContext([Dialog.displayName, Title.name].join('.'))\n\n  let id = `headlessui-dialog-title-${useId()}`\n\n  useEffect(() => {\n    setTitleId(id)\n    return () => setTitleId(null)\n  }, [id, setTitleId])\n\n  let slot = useMemo<TitleRenderPropArg>(() => ({ open: dialogState === DialogStates.Open }), [\n    dialogState,\n  ])\n  let propsWeControl = { id }\n  let passthroughProps = props\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_TITLE_TAG,\n    name: 'Dialog.Title',\n  })\n}\n\n// ---\n\nexport let Dialog = Object.assign(DialogRoot, { Overlay, Title, Description })\n"],"names":["DialogStates","ActionTypes","reducers","SetTitleId","state","action","titleId","id","DialogContext","createContext","displayName","useDialogContext","component","context","useContext","err","Error","Dialog","captureStackTrace","stateReducer","match","type","DEFAULT_DIALOG_TAG","DialogRenderFeatures","Features","RenderStrategy","Static","DialogRoot","forwardRefWithAs","props","ref","open","onClose","initialFocus","rest","useState","nestedDialogCount","setNestedDialogCount","usesOpenClosedState","useOpenClosed","undefined","State","Open","Closed","containers","useRef","Set","internalDialogRef","dialogRef","useSyncRefs","hasOpen","hasOwnProperty","hasOnClose","dialogState","visible","useReducer","descriptionId","dispatch","close","useCallback","setTitleId","ready","useServerHandoffComplete","enabled","hasNestedDialogs","hasParentDialog","position","useFocusTrap","parent","FocusTrapFeatures","RestoreFocus","leaf","All","None","useInertOthers","useWindowEvent","event","target","current","contains","useEffect","overflow","document","documentElement","style","paddingRight","scrollbarWidth","window","innerWidth","clientWidth","observer","IntersectionObserver","entries","entry","boundingClientRect","x","y","width","height","observe","disconnect","useDescriptions","describedby","DescriptionProvider","useId","contextBag","useMemo","slot","propsWeControl","role","onClick","stopPropagation","onKeyDown","key","Keys","Escape","preventDefault","passthroughProps","React","StackProvider","element","onUpdate","message","StackMessage","Add","add","count","Remove","ForcePortalRoot","force","Portal","Provider","value","Group","name","render","defaultTag","features","DEFAULT_OVERLAY_TAG","Overlay","join","overlayRef","handleClick","isDisabledReactIssue7711","currentTarget","DEFAULT_TITLE_TAG","Title","Object","assign","Description"],"mappings":"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"}